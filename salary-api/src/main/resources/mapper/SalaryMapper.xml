<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuhao.payroll.mapper.SalaryMapper">
    
    <!-- 获取部门工资统计 -->
    <select id="getDepartmentSalaryStats" resultType="java.util.Map">
        SELECT 
            d.dept_name,
            SUM(s.net_salary) as total_salary
        FROM salary s
        JOIN employee e ON s.emp_id = e.emp_id
        JOIN department d ON e.dept_id = d.dept_id
        WHERE s.year = #{year} AND s.month = #{month}
        GROUP BY d.dept_id, d.dept_name
    </select>

    <!-- 获取月度工资统计 -->
    <select id="getMonthlySalaryStats" resultType="java.util.Map">
        SELECT 
            CAST(month AS VARCHAR) as month,
            SUM(net_salary) as total_salary
        FROM salary
        WHERE year = #{year}
        GROUP BY month
        ORDER BY month
    </select>

    <!-- 获取指定月份所有工资 -->
    <select id="getAllSalaries" resultType="java.math.BigDecimal">
        SELECT net_salary
        FROM salary
        WHERE year = #{year} AND month = #{month}
    </select>

    <!-- 获取部门平均工资统计 -->
    <select id="getDepartmentAvgSalaryStats" resultType="java.util.Map">
        SELECT 
            d.dept_name,
            AVG(s.net_salary) as avg_salary
        FROM salary s
        JOIN employee e ON s.emp_id = e.emp_id
        JOIN department d ON e.dept_id = d.dept_id
        WHERE s.year = #{year} AND s.month = #{month}
        GROUP BY d.dept_id, d.dept_name
    </select>

    <!-- 获取工资组成统计 -->
    <select id="getSalaryComponentStats" resultType="java.util.Map">
        SELECT 
            emp_id,
            basic_salary,
            position_salary,
            overtime_pay,
            bonus,
            insurance,
            housing_fund,
            tax,
            deduction
        FROM salary
        WHERE year = #{year} AND month = #{month}
    </select>

    <!-- 获取年度工资统计 -->
    <select id="getYearlySalaryStats" resultType="java.util.Map">
        SELECT 
            year,
            SUM(net_salary) as total_salary
        FROM salary
        GROUP BY year
        ORDER BY year
    </select>
</mapper> 